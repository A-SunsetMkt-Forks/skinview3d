{"version":3,"file":"skinview3d.min.js","sources":["../src/model.js","../src/orbit_controls.js","../src/animation.js","../src/viewer.js"],"sourcesContent":["import * as THREE from \"three\";\r\n\r\nfunction toFaceVertices(x1, y1, x2, y2, w, h) {\r\n\treturn [\r\n\t\tnew THREE.Vector2(x1 / w, 1.0 - y2 / h),\r\n\t\tnew THREE.Vector2(x2 / w, 1.0 - y2 / h),\r\n\t\tnew THREE.Vector2(x2 / w, 1.0 - y1 / h),\r\n\t\tnew THREE.Vector2(x1 / w, 1.0 - y1 / h)\r\n\t];\r\n}\r\n\r\nfunction toSkinVertices(x1, y1, x2, y2) {\r\n\treturn toFaceVertices(x1, y1, x2, y2, 64.0, 64.0);\r\n}\r\n\r\nfunction toCapeVertices(x1, y1, x2, y2) {\r\n\treturn toFaceVertices(x1, y1, x2, y2, 64.0, 32.0);\r\n}\r\n\r\nfunction addVertices(box, top, bottom, left, front, right, back) {\r\n\tbox.faceVertexUvs[0] = [];\r\n\tbox.faceVertexUvs[0][0] = [right[3], right[0], right[2]];\r\n\tbox.faceVertexUvs[0][1] = [right[0], right[1], right[2]];\r\n\tbox.faceVertexUvs[0][2] = [left[3], left[0], left[2]];\r\n\tbox.faceVertexUvs[0][3] = [left[0], left[1], left[2]];\r\n\tbox.faceVertexUvs[0][4] = [top[3], top[0], top[2]];\r\n\tbox.faceVertexUvs[0][5] = [top[0], top[1], top[2]];\r\n\tbox.faceVertexUvs[0][6] = [bottom[0], bottom[3], bottom[1]];\r\n\tbox.faceVertexUvs[0][7] = [bottom[3], bottom[2], bottom[1]];\r\n\tbox.faceVertexUvs[0][8] = [front[3], front[0], front[2]];\r\n\tbox.faceVertexUvs[0][9] = [front[0], front[1], front[2]];\r\n\tbox.faceVertexUvs[0][10] = [back[3], back[0], back[2]];\r\n\tbox.faceVertexUvs[0][11] = [back[0], back[1], back[2]];\r\n}\r\n\r\nconst esp = 0.002;\r\n\r\nclass SkinObject extends THREE.Group {\r\n\tconstructor(isSlim, layer1Material, layer2Material) {\r\n\t\tsuper();\r\n\r\n\t\t// Head\r\n\t\tthis.head = new THREE.Group();\r\n\r\n\t\tlet headBox = new THREE.BoxGeometry(8, 8, 8, 0, 0, 0);\r\n\t\taddVertices(headBox,\r\n\t\t\ttoSkinVertices(8, 0, 16, 8),\r\n\t\t\ttoSkinVertices(16, 0, 24, 8),\r\n\t\t\ttoSkinVertices(0, 8, 8, 16),\r\n\t\t\ttoSkinVertices(8, 8, 16, 16),\r\n\t\t\ttoSkinVertices(16, 8, 24, 16),\r\n\t\t\ttoSkinVertices(24, 8, 32, 16)\r\n\t\t);\r\n\t\tlet headMesh = new THREE.Mesh(headBox, layer1Material);\r\n\t\tthis.head.add(headMesh);\r\n\r\n\t\tlet head2Box = new THREE.BoxGeometry(9, 9, 9, 0, 0, 0);\r\n\t\taddVertices(head2Box,\r\n\t\t\ttoSkinVertices(40, 0, 48, 8),\r\n\t\t\ttoSkinVertices(48, 0, 56, 8),\r\n\t\t\ttoSkinVertices(32, 8, 40, 16),\r\n\t\t\ttoSkinVertices(40, 8, 48, 16),\r\n\t\t\ttoSkinVertices(48, 8, 56, 16),\r\n\t\t\ttoSkinVertices(56, 8, 64, 16)\r\n\t\t);\r\n\t\tlet head2Mesh = new THREE.Mesh(head2Box, layer2Material);\r\n\t\thead2Mesh.renderOrder = -1;\r\n\t\tthis.head.add(head2Mesh);\r\n\r\n\t\tthis.add(this.head);\r\n\r\n\r\n\t\t// Body\r\n\t\tthis.body = new THREE.Group();\r\n\r\n\t\tlet bodyBox = new THREE.BoxGeometry(8, 12, 4, 0, 0, 0);\r\n\t\taddVertices(bodyBox,\r\n\t\t\ttoSkinVertices(20, 16, 28, 20),\r\n\t\t\ttoSkinVertices(28, 16, 36, 20),\r\n\t\t\ttoSkinVertices(16, 20, 20, 32),\r\n\t\t\ttoSkinVertices(20, 20, 28, 32),\r\n\t\t\ttoSkinVertices(28, 20, 32, 32),\r\n\t\t\ttoSkinVertices(32, 20, 40, 32)\r\n\t\t);\r\n\t\tlet bodyMesh = new THREE.Mesh(bodyBox, layer1Material);\r\n\t\tthis.body.add(bodyMesh);\r\n\r\n\t\tlet body2Box = new THREE.BoxGeometry(9, 13.5, 4.5, 0, 0, 0);\r\n\t\taddVertices(body2Box,\r\n\t\t\ttoSkinVertices(20, 32, 28, 36),\r\n\t\t\ttoSkinVertices(28, 32, 36, 36),\r\n\t\t\ttoSkinVertices(16, 36, 20, 48),\r\n\t\t\ttoSkinVertices(20, 36, 28, 48),\r\n\t\t\ttoSkinVertices(28, 36, 32, 48),\r\n\t\t\ttoSkinVertices(32, 36, 40, 48)\r\n\t\t);\r\n\t\tlet body2Mesh = new THREE.Mesh(body2Box, layer2Material);\r\n\t\tthis.body.add(body2Mesh);\r\n\r\n\t\tthis.body.position.y = -10;\r\n\t\tthis.add(this.body);\r\n\r\n\r\n\t\t// Right Arm\r\n\t\tthis.rightArm = new THREE.Group();\r\n\t\tlet rightArmPivot = new THREE.Group();\r\n\r\n\t\tlet rightArmBox = new THREE.BoxGeometry((isSlim ? 3 : 4) - esp, 12 - esp, 4 - esp, 0, 0, 0);\r\n\t\tif (isSlim) {\r\n\t\t\taddVertices(rightArmBox,\r\n\t\t\t\ttoSkinVertices(44, 16, 47, 20),\r\n\t\t\t\ttoSkinVertices(47, 16, 50, 20),\r\n\t\t\t\ttoSkinVertices(40, 20, 44, 32),\r\n\t\t\t\ttoSkinVertices(44, 20, 47, 32),\r\n\t\t\t\ttoSkinVertices(47, 20, 51, 32),\r\n\t\t\t\ttoSkinVertices(51, 20, 54, 32)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\taddVertices(rightArmBox,\r\n\t\t\t\ttoSkinVertices(44, 16, 48, 20),\r\n\t\t\t\ttoSkinVertices(48, 16, 52, 20),\r\n\t\t\t\ttoSkinVertices(40, 20, 44, 32),\r\n\t\t\t\ttoSkinVertices(44, 20, 48, 32),\r\n\t\t\t\ttoSkinVertices(48, 20, 52, 32),\r\n\t\t\t\ttoSkinVertices(52, 20, 56, 32)\r\n\t\t\t);\r\n\t\t}\r\n\t\tlet rightArmMesh = new THREE.Mesh(rightArmBox, layer1Material);\r\n\t\trightArmPivot.add(rightArmMesh);\r\n\r\n\t\tlet rightArm2Box = new THREE.BoxGeometry((isSlim ? 3.375 : 4.5) - esp, 13.5 - esp, 4.5 - esp, 0, 0, 0);\r\n\t\tif (isSlim) {\r\n\t\t\taddVertices(rightArm2Box,\r\n\t\t\t\ttoSkinVertices(44, 32, 47, 36),\r\n\t\t\t\ttoSkinVertices(47, 32, 50, 36),\r\n\t\t\t\ttoSkinVertices(40, 36, 44, 48),\r\n\t\t\t\ttoSkinVertices(44, 36, 47, 48),\r\n\t\t\t\ttoSkinVertices(47, 36, 51, 48),\r\n\t\t\t\ttoSkinVertices(51, 36, 54, 48)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\taddVertices(rightArm2Box,\r\n\t\t\t\ttoSkinVertices(44, 32, 48, 36),\r\n\t\t\t\ttoSkinVertices(48, 32, 52, 36),\r\n\t\t\t\ttoSkinVertices(40, 36, 44, 48),\r\n\t\t\t\ttoSkinVertices(44, 36, 48, 48),\r\n\t\t\t\ttoSkinVertices(48, 36, 52, 48),\r\n\t\t\t\ttoSkinVertices(52, 36, 56, 48)\r\n\t\t\t);\r\n\t\t}\r\n\t\tlet rightArm2Mesh = new THREE.Mesh(rightArm2Box, layer2Material);\r\n\t\trightArm2Mesh.renderOrder = 1;\r\n\t\trightArmPivot.add(rightArm2Mesh);\r\n\r\n\t\trightArmPivot.position.y = -6;\r\n\t\tthis.rightArm.add(rightArmPivot);\r\n\t\tthis.rightArm.position.y = -4;\r\n\t\tthis.rightArm.position.x = isSlim ? -5.5 : -6;\r\n\t\tthis.add(this.rightArm);\r\n\r\n\r\n\t\t// Left Arm\r\n\t\tthis.leftArm = new THREE.Group();\r\n\t\tlet leftArmPivot = new THREE.Group();\r\n\r\n\t\tlet leftArmBox = new THREE.BoxGeometry((isSlim ? 3 : 4) - esp, 12 - esp, 4 - esp, 0, 0, 0);\r\n\t\tif (isSlim) {\r\n\t\t\taddVertices(leftArmBox,\r\n\t\t\t\ttoSkinVertices(36, 48, 39, 52),\r\n\t\t\t\ttoSkinVertices(39, 48, 42, 52),\r\n\t\t\t\ttoSkinVertices(32, 52, 36, 64),\r\n\t\t\t\ttoSkinVertices(36, 52, 39, 64),\r\n\t\t\t\ttoSkinVertices(39, 52, 43, 64),\r\n\t\t\t\ttoSkinVertices(43, 52, 46, 64)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\taddVertices(leftArmBox,\r\n\t\t\t\ttoSkinVertices(36, 48, 40, 52),\r\n\t\t\t\ttoSkinVertices(40, 48, 44, 52),\r\n\t\t\t\ttoSkinVertices(32, 52, 36, 64),\r\n\t\t\t\ttoSkinVertices(36, 52, 40, 64),\r\n\t\t\t\ttoSkinVertices(40, 52, 44, 64),\r\n\t\t\t\ttoSkinVertices(44, 52, 48, 64)\r\n\t\t\t);\r\n\t\t}\r\n\t\tlet leftArmMesh = new THREE.Mesh(leftArmBox, layer1Material);\r\n\t\tleftArmPivot.add(leftArmMesh);\r\n\r\n\t\tlet leftArm2Box = new THREE.BoxGeometry((isSlim ? 3.375 : 4.5) - esp, 13.5 - esp, 4.5 - esp, 0, 0, 0);\r\n\t\tif (isSlim) {\r\n\t\t\taddVertices(leftArm2Box,\r\n\t\t\t\ttoSkinVertices(52, 48, 55, 52),\r\n\t\t\t\ttoSkinVertices(55, 48, 58, 52),\r\n\t\t\t\ttoSkinVertices(48, 52, 52, 64),\r\n\t\t\t\ttoSkinVertices(52, 52, 55, 64),\r\n\t\t\t\ttoSkinVertices(55, 52, 59, 64),\r\n\t\t\t\ttoSkinVertices(59, 52, 62, 64)\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\taddVertices(leftArm2Box,\r\n\t\t\t\ttoSkinVertices(52, 48, 56, 52),\r\n\t\t\t\ttoSkinVertices(56, 48, 60, 52),\r\n\t\t\t\ttoSkinVertices(48, 52, 52, 64),\r\n\t\t\t\ttoSkinVertices(52, 52, 56, 64),\r\n\t\t\t\ttoSkinVertices(56, 52, 60, 64),\r\n\t\t\t\ttoSkinVertices(60, 52, 64, 64)\r\n\t\t\t);\r\n\t\t}\r\n\t\tlet leftArm2Mesh = new THREE.Mesh(leftArm2Box, layer2Material);\r\n\t\tleftArm2Mesh.renderOrder = 1;\r\n\t\tleftArmPivot.add(leftArm2Mesh);\r\n\r\n\t\tleftArmPivot.position.y = -6;\r\n\t\tthis.leftArm.add(leftArmPivot);\r\n\t\tthis.leftArm.position.y = -4;\r\n\t\tthis.leftArm.position.x = isSlim ? 5.5 : 6;\r\n\t\tthis.add(this.leftArm);\r\n\r\n\r\n\t\t// Right Leg\r\n\t\tthis.rightLeg = new THREE.Group();\r\n\t\tlet rightLegPivot = new THREE.Group();\r\n\r\n\t\tlet rightLegBox = new THREE.BoxGeometry(4 - esp, 12 - esp, 4 - esp, 0, 0, 0);\r\n\t\taddVertices(rightLegBox,\r\n\t\t\ttoSkinVertices(4, 16, 8, 20),\r\n\t\t\ttoSkinVertices(8, 16, 12, 20),\r\n\t\t\ttoSkinVertices(0, 20, 4, 32),\r\n\t\t\ttoSkinVertices(4, 20, 8, 32),\r\n\t\t\ttoSkinVertices(8, 20, 12, 32),\r\n\t\t\ttoSkinVertices(12, 20, 16, 32)\r\n\t\t);\r\n\t\tlet rightLegMesh = new THREE.Mesh(rightLegBox, layer1Material);\r\n\t\trightLegPivot.add(rightLegMesh);\r\n\r\n\t\tlet rightLeg2Box = new THREE.BoxGeometry(4.5 - esp, 13.5 - esp, 4.5 - esp, 0, 0, 0);\r\n\t\taddVertices(rightLeg2Box,\r\n\t\t\ttoSkinVertices(4, 32, 8, 36),\r\n\t\t\ttoSkinVertices(8, 32, 12, 36),\r\n\t\t\ttoSkinVertices(0, 36, 4, 48),\r\n\t\t\ttoSkinVertices(4, 36, 8, 48),\r\n\t\t\ttoSkinVertices(8, 36, 12, 48),\r\n\t\t\ttoSkinVertices(12, 36, 16, 48)\r\n\t\t);\r\n\t\tlet rightLeg2Mesh = new THREE.Mesh(rightLeg2Box, layer2Material);\r\n\t\trightLeg2Mesh.renderOrder = 1;\r\n\t\trightLegPivot.add(rightLeg2Mesh);\r\n\r\n\t\trightLegPivot.position.y = -6;\r\n\t\tthis.rightLeg.add(rightLegPivot);\r\n\t\tthis.rightLeg.position.y = -16;\r\n\t\tthis.rightLeg.position.x = -2;\r\n\t\tthis.add(this.rightLeg);\r\n\r\n\t\t// Left Leg\r\n\t\tthis.leftLeg = new THREE.Group();\r\n\t\tlet leftLegPivot = new THREE.Group();\r\n\r\n\t\tlet leftLegBox = new THREE.BoxGeometry(4 - esp, 12 - esp, 4 - esp, 0, 0, 0);\r\n\t\taddVertices(leftLegBox,\r\n\t\t\ttoSkinVertices(20, 48, 24, 52),\r\n\t\t\ttoSkinVertices(24, 48, 28, 52),\r\n\t\t\ttoSkinVertices(16, 52, 20, 64),\r\n\t\t\ttoSkinVertices(20, 52, 24, 64),\r\n\t\t\ttoSkinVertices(24, 52, 28, 64),\r\n\t\t\ttoSkinVertices(28, 52, 32, 64)\r\n\t\t);\r\n\t\tlet leftLegMesh = new THREE.Mesh(leftLegBox, layer1Material);\r\n\t\tleftLegPivot.add(leftLegMesh);\r\n\r\n\t\tlet leftLeg2Box = new THREE.BoxGeometry(4.5 - esp, 13.5 - esp, 4.5 - esp, 0, 0, 0);\r\n\t\taddVertices(leftLeg2Box,\r\n\t\t\ttoSkinVertices(4, 48, 8, 52),\r\n\t\t\ttoSkinVertices(8, 48, 12, 52),\r\n\t\t\ttoSkinVertices(0, 52, 4, 64),\r\n\t\t\ttoSkinVertices(4, 52, 8, 64),\r\n\t\t\ttoSkinVertices(8, 52, 12, 64),\r\n\t\t\ttoSkinVertices(12, 52, 16, 64)\r\n\t\t);\r\n\t\tlet leftLeg2Mesh = new THREE.Mesh(leftLeg2Box, layer2Material);\r\n\t\tleftLeg2Mesh.renderOrder = 1;\r\n\t\tleftLegPivot.add(leftLeg2Mesh);\r\n\r\n\t\tleftLegPivot.position.y = -6;\r\n\t\tthis.leftLeg.add(leftLegPivot);\r\n\t\tthis.leftLeg.position.y = -16;\r\n\t\tthis.leftLeg.position.x = 2;\r\n\t\tthis.add(this.leftLeg);\r\n\t}\r\n}\r\n\r\nclass CapeObject extends THREE.Group {\r\n\tconstructor(capeMaterial) {\r\n\t\tsuper();\r\n\r\n\t\t// back = outside\r\n\t\t// front = inside\r\n\t\tlet capeBox = new THREE.BoxGeometry(10, 16, 1, 0, 0, 0);\r\n\t\taddVertices(capeBox,\r\n\t\t\ttoCapeVertices(1, 0, 11, 1),\r\n\t\t\ttoCapeVertices(11, 0, 21, 1),\r\n\t\t\ttoCapeVertices(11, 1, 12, 17),\r\n\t\t\ttoCapeVertices(12, 1, 22, 17),\r\n\t\t\ttoCapeVertices(0, 1, 1, 17),\r\n\t\t\ttoCapeVertices(1, 1, 11, 17)\r\n\t\t);\r\n\t\tthis.cape = new THREE.Mesh(capeBox, capeMaterial);\r\n\t\tthis.cape.position.y = -8;\r\n\t\tthis.cape.position.z = -0.5;\r\n\t\tthis.add(this.cape);\r\n\t}\r\n}\r\n\r\nclass PlayerObject extends THREE.Group {\r\n\tconstructor(slim, layer1Material, layer2Material, capeMaterial) {\r\n\t\tsuper();\r\n\r\n\t\tthis.slim = slim;\r\n\r\n\t\tthis.skin = new SkinObject(slim, layer1Material, layer2Material);\r\n\t\tthis.skin.visible = false;\r\n\t\tthis.add(this.skin);\r\n\r\n\t\tthis.cape = new CapeObject(capeMaterial);\r\n\t\tthis.cape.position.z = -2;\r\n\t\tthis.cape.position.y = -4;\r\n\t\tthis.cape.rotation.x = 25 * Math.PI / 180;\r\n\t\tthis.cape.visible = false;\r\n\t\tthis.add(this.cape);\r\n\t}\r\n}\r\n\r\nexport { SkinObject, CapeObject, PlayerObject };\r\n","import * as THREE from \"three\";\r\n\r\nclass OrbitControls extends THREE.EventDispatcher {\r\n\t/**\r\n\t * @preserve\r\n\t * The code was originally from https://github.com/mrdoob/three.js/blob/d45a042cf962e9b1aa9441810ba118647b48aacb/examples/js/controls/OrbitControls.js\r\n\t */\r\n\t/**\r\n\t * @license\r\n\t * Copyright (C) 2010-2017 three.js authors\r\n\t *\r\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\r\n\t * of this software and associated documentation files (the \"Software\"), to deal\r\n\t * in the Software without restriction, including without limitation the rights\r\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\n\t * copies of the Software, and to permit persons to whom the Software is\r\n\t * furnished to do so, subject to the following conditions:\r\n\t *\r\n\t * The above copyright notice and this permission notice shall be included in\r\n\t * all copies or substantial portions of the Software.\r\n\t *\r\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\r\n\t * THE SOFTWARE.\r\n\t *\r\n\t *\r\n\t * @author qiao / https://github.com/qiao\r\n\t * @author mrdoob / http://mrdoob.com\r\n\t * @author alteredq / http://alteredqualia.com/\r\n\t * @author WestLangley / http://github.com/WestLangley\r\n\t * @author erich666 / http://erichaines.com\r\n\t */\r\n\r\n\t// This set of controls performs orbiting, dollying (zooming), and panning.\r\n\t// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n\t//\r\n\t//    Orbit - left mouse / touch: one finger move\r\n\t//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\r\n\t//    Pan - right mouse, or arrow keys / touch: three finger swipe\r\n\r\n\tconstructor(object, domElement) {\r\n\t\tsuper();\r\n\t\tthis.object = object;\r\n\t\tthis.domElement = (domElement !== undefined) ? domElement : document;\r\n\r\n\t\t// Set to false to disable this control\r\n\t\tthis.enabled = true;\r\n\r\n\t\t// \"target\" sets the location of focus, where the object orbits around\r\n\t\tthis.target = new THREE.Vector3();\r\n\r\n\t\t// How far you can dolly in and out (PerspectiveCamera only)\r\n\t\tthis.minDistance = 0;\r\n\t\tthis.maxDistance = Infinity;\r\n\r\n\t\t// How far you can zoom in and out (OrthographicCamera only)\r\n\t\tthis.minZoom = 0;\r\n\t\tthis.maxZoom = Infinity;\r\n\r\n\t\t// How far you can orbit vertically, upper and lower limits.\r\n\t\t// Range is 0 to Math.PI radians.\r\n\t\tthis.minPolarAngle = 0; // radians\r\n\t\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t\t// How far you can orbit horizontally, upper and lower limits.\r\n\t\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n\t\tthis.minAzimuthAngle = -Infinity; // radians\r\n\t\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t\t// Set to true to enable damping (inertia)\r\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.enableDamping = false;\r\n\t\tthis.dampingFactor = 0.25;\r\n\r\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t\t// Set to false to disable zooming\r\n\t\tthis.enableZoom = true;\r\n\t\tthis.zoomSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable rotating\r\n\t\tthis.enableRotate = true;\r\n\t\tthis.rotateSpeed = 1.0;\r\n\r\n\t\t// Set to false to disable panning\r\n\t\tthis.enablePan = true;\r\n\t\tthis.keyPanSpeed = 7.0; // pixels moved per arrow key push\r\n\r\n\t\t// Set to true to automatically rotate around the target\r\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\t\tthis.autoRotate = false;\r\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n\t\t// Set to false to disable use of the keys\r\n\t\tthis.enableKeys = true;\r\n\r\n\t\t// The four arrow keys\r\n\t\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n\t\t// Mouse buttons\r\n\t\tthis.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };\r\n\r\n\t\t// for reset\r\n\t\tthis.target0 = this.target.clone();\r\n\t\tthis.position0 = this.object.position.clone();\r\n\t\tthis.zoom0 = this.object.zoom;\r\n\r\n\t\t//\r\n\t\t// public methods\r\n\t\t//\r\n\t\tthis.getPolarAngle = function () {\r\n\t\t\treturn spherical.phi;\r\n\t\t};\r\n\t\tthis.getAzimuthalAngle = function () {\r\n\t\t\treturn spherical.theta;\r\n\t\t};\r\n\t\tthis.saveState = function () {\r\n\t\t\tscope.target0.copy(scope.target);\r\n\t\t\tscope.position0.copy(scope.object.position);\r\n\t\t\tscope.zoom0 = scope.object.zoom;\r\n\t\t};\r\n\t\tthis.reset = function () {\r\n\t\t\tscope.target.copy(scope.target0);\r\n\t\t\tscope.object.position.copy(scope.position0);\r\n\t\t\tscope.object.zoom = scope.zoom0;\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tscope.dispatchEvent(changeEvent);\r\n\t\t\tscope.update();\r\n\t\t\tstate = STATE.NONE;\r\n\t\t};\r\n\r\n\t\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\t\tthis.update = function () {\r\n\t\t\tlet offset = new THREE.Vector3();\r\n\t\t\t// so camera.up is the orbit axis\r\n\t\t\tlet quat = new THREE.Quaternion().setFromUnitVectors(object.up, new THREE.Vector3(0, 1, 0));\r\n\t\t\tlet quatInverse = quat.clone().inverse();\r\n\t\t\tlet lastPosition = new THREE.Vector3();\r\n\t\t\tlet lastQuaternion = new THREE.Quaternion();\r\n\t\t\treturn function update() {\r\n\t\t\t\tlet position = scope.object.position;\r\n\t\t\t\toffset.copy(position).sub(scope.target);\r\n\t\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\t\toffset.applyQuaternion(quat);\r\n\t\t\t\t// angle from z-axis around y-axis\r\n\t\t\t\tspherical.setFromVector3(offset);\r\n\t\t\t\tif (scope.autoRotate && state === STATE.NONE) {\r\n\t\t\t\t\trotateLeft(getAutoRotationAngle());\r\n\t\t\t\t}\r\n\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\t\t\t\t// restrict theta to be between desired limits\r\n\t\t\t\tspherical.theta = Math.max(scope.minAzimuthAngle, Math.min(scope.maxAzimuthAngle, spherical.theta));\r\n\t\t\t\t// restrict phi to be between desired limits\r\n\t\t\t\tspherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\r\n\t\t\t\tspherical.makeSafe();\r\n\t\t\t\tspherical.radius *= scale;\r\n\t\t\t\t// restrict radius to be between desired limits\r\n\t\t\t\tspherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));\r\n\t\t\t\t// move target to panned location\r\n\t\t\t\tscope.target.add(panOffset);\r\n\t\t\t\toffset.setFromSpherical(spherical);\r\n\t\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\t\toffset.applyQuaternion(quatInverse);\r\n\t\t\t\tposition.copy(scope.target).add(offset);\r\n\t\t\t\tscope.object.lookAt(scope.target);\r\n\t\t\t\tif (scope.enableDamping === true) {\r\n\t\t\t\t\tsphericalDelta.theta *= (1 - scope.dampingFactor);\r\n\t\t\t\t\tsphericalDelta.phi *= (1 - scope.dampingFactor);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tsphericalDelta.set(0, 0, 0);\r\n\t\t\t\t}\r\n\t\t\t\tscale = 1;\r\n\t\t\t\tpanOffset.set(0, 0, 0);\r\n\t\t\t\t// update condition is:\r\n\t\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\t\t\t\tif (zoomChanged ||\r\n\t\t\t\t\tlastPosition.distanceToSquared(scope.object.position) > EPS ||\r\n\t\t\t\t\t8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS) {\r\n\t\t\t\t\tscope.dispatchEvent(changeEvent);\r\n\t\t\t\t\tlastPosition.copy(scope.object.position);\r\n\t\t\t\t\tlastQuaternion.copy(scope.object.quaternion);\r\n\t\t\t\t\tzoomChanged = false;\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\t\t}();\r\n\t\tthis.dispose = function () {\r\n\t\t\tscope.domElement.removeEventListener(\"contextmenu\", onContextMenu, false);\r\n\t\t\tscope.domElement.removeEventListener(\"mousedown\", onMouseDown, false);\r\n\t\t\tscope.domElement.removeEventListener(\"wheel\", onMouseWheel, false);\r\n\t\t\tscope.domElement.removeEventListener(\"touchstart\", onTouchStart, false);\r\n\t\t\tscope.domElement.removeEventListener(\"touchend\", onTouchEnd, false);\r\n\t\t\tscope.domElement.removeEventListener(\"touchmove\", onTouchMove, false);\r\n\t\t\tdocument.removeEventListener(\"mousemove\", onMouseMove, false);\r\n\t\t\tdocument.removeEventListener(\"mouseup\", onMouseUp, false);\r\n\t\t\twindow.removeEventListener(\"keydown\", onKeyDown, false);\r\n\t\t\t//scope.dispatchEvent({ type: \"dispose\" }); // should this be added here?\r\n\t\t};\r\n\t\t//\r\n\t\t// internals\r\n\t\t//\r\n\t\tlet scope = this;\r\n\t\tlet changeEvent = { type: \"change\" };\r\n\t\tlet startEvent = { type: \"start\" };\r\n\t\tlet endEvent = { type: \"end\" };\r\n\t\tlet STATE = { NONE: -1, ROTATE: 0, DOLLY: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_DOLLY: 4, TOUCH_PAN: 5 };\r\n\t\tlet state = STATE.NONE;\r\n\t\tlet EPS = 0.000001;\r\n\t\t// current position in spherical coordinates\r\n\t\tlet spherical = new THREE.Spherical();\r\n\t\tlet sphericalDelta = new THREE.Spherical();\r\n\t\tlet scale = 1;\r\n\t\tlet panOffset = new THREE.Vector3();\r\n\t\tlet zoomChanged = false;\r\n\t\tlet rotateStart = new THREE.Vector2();\r\n\t\tlet rotateEnd = new THREE.Vector2();\r\n\t\tlet rotateDelta = new THREE.Vector2();\r\n\t\tlet panStart = new THREE.Vector2();\r\n\t\tlet panEnd = new THREE.Vector2();\r\n\t\tlet panDelta = new THREE.Vector2();\r\n\t\tlet dollyStart = new THREE.Vector2();\r\n\t\tlet dollyEnd = new THREE.Vector2();\r\n\t\tlet dollyDelta = new THREE.Vector2();\r\n\t\tfunction getAutoRotationAngle() {\r\n\t\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\t\t}\r\n\t\tfunction getZoomScale() {\r\n\t\t\treturn Math.pow(0.95, scope.zoomSpeed);\r\n\t\t}\r\n\t\tfunction rotateLeft(angle) {\r\n\t\t\tsphericalDelta.theta -= angle;\r\n\t\t}\r\n\t\tfunction rotateUp(angle) {\r\n\t\t\tsphericalDelta.phi -= angle;\r\n\t\t}\r\n\t\tlet panLeft = function () {\r\n\t\t\tlet v = new THREE.Vector3();\r\n\t\t\treturn function panLeft(distance, objectMatrix) {\r\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\r\n\t\t\t\tv.multiplyScalar(-distance);\r\n\t\t\t\tpanOffset.add(v);\r\n\t\t\t};\r\n\t\t}();\r\n\t\tlet panUp = function () {\r\n\t\t\tlet v = new THREE.Vector3();\r\n\t\t\treturn function panUp(distance, objectMatrix) {\r\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 1); // get Y column of objectMatrix\r\n\t\t\t\tv.multiplyScalar(distance);\r\n\t\t\t\tpanOffset.add(v);\r\n\t\t\t};\r\n\t\t}();\r\n\t\t// deltaX and deltaY are in pixels; right and down are positive\r\n\t\tlet pan = function () {\r\n\t\t\tlet offset = new THREE.Vector3();\r\n\t\t\treturn function pan(deltaX, deltaY) {\r\n\t\t\t\tlet element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\t\t\t\tif (scope.object instanceof THREE.PerspectiveCamera) {\r\n\t\t\t\t\t// perspective\r\n\t\t\t\t\tlet position = scope.object.position;\r\n\t\t\t\t\toffset.copy(position).sub(scope.target);\r\n\t\t\t\t\tlet targetDistance = offset.length();\r\n\t\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\t\ttargetDistance *= Math.tan((scope.object.fov / 2) * Math.PI / 180.0);\r\n\t\t\t\t\t// we actually don't use screenWidth, since perspective camera is fixed to screen height\r\n\t\t\t\t\tpanLeft(2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix);\r\n\t\t\t\t\tpanUp(2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix);\r\n\t\t\t\t}\r\n\t\t\t\telse if (scope.object instanceof THREE.OrthographicCamera) {\r\n\t\t\t\t\t// orthographic\r\n\t\t\t\t\tpanLeft(deltaX * (scope.object.right - scope.object.left) / scope.object.zoom / element.clientWidth, scope.object.matrix);\r\n\t\t\t\t\tpanUp(deltaY * (scope.object.top - scope.object.bottom) / scope.object.zoom / element.clientHeight, scope.object.matrix);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\t\tconsole.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.\");\r\n\t\t\t\t\tscope.enablePan = false;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}();\r\n\t\tfunction dollyIn(dollyScale) {\r\n\t\t\tif (scope.object instanceof THREE.PerspectiveCamera) {\r\n\t\t\t\tscale /= dollyScale;\r\n\t\t\t}\r\n\t\t\telse if (scope.object instanceof THREE.OrthographicCamera) {\r\n\t\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\");\r\n\t\t\t\tscope.enableZoom = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction dollyOut(dollyScale) {\r\n\t\t\tif (scope.object instanceof THREE.PerspectiveCamera) {\r\n\t\t\t\tscale *= dollyScale;\r\n\t\t\t}\r\n\t\t\telse if (scope.object instanceof THREE.OrthographicCamera) {\r\n\t\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\r\n\t\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\t\tzoomChanged = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tconsole.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.\");\r\n\t\t\t\tscope.enableZoom = false;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//\r\n\t\t// event callbacks - update the object state\r\n\t\t//\r\n\t\tfunction handleMouseDownRotate(event) {\r\n\t\t\trotateStart.set(event.clientX, event.clientY);\r\n\t\t}\r\n\t\tfunction handleMouseDownDolly(event) {\r\n\t\t\tdollyStart.set(event.clientX, event.clientY);\r\n\t\t}\r\n\t\tfunction handleMouseDownPan(event) {\r\n\t\t\tpanStart.set(event.clientX, event.clientY);\r\n\t\t}\r\n\t\tfunction handleMouseMoveRotate(event) {\r\n\t\t\trotateEnd.set(event.clientX, event.clientY);\r\n\t\t\trotateDelta.subVectors(rotateEnd, rotateStart);\r\n\t\t\tlet element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\t\t\t// rotating across whole screen goes 360 degrees around\r\n\t\t\trotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed);\r\n\t\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\r\n\t\t\trotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\r\n\t\t\trotateStart.copy(rotateEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleMouseMoveDolly(event) {\r\n\t\t\tdollyEnd.set(event.clientX, event.clientY);\r\n\t\t\tdollyDelta.subVectors(dollyEnd, dollyStart);\r\n\t\t\tif (dollyDelta.y > 0) {\r\n\t\t\t\tdollyIn(getZoomScale());\r\n\t\t\t}\r\n\t\t\telse if (dollyDelta.y < 0) {\r\n\t\t\t\tdollyOut(getZoomScale());\r\n\t\t\t}\r\n\t\t\tdollyStart.copy(dollyEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleMouseMovePan(event) {\r\n\t\t\tpanEnd.set(event.clientX, event.clientY);\r\n\t\t\tpanDelta.subVectors(panEnd, panStart);\r\n\t\t\tpan(panDelta.x, panDelta.y);\r\n\t\t\tpanStart.copy(panEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleMouseUp(event) {\r\n\t\t}\r\n\t\tfunction handleMouseWheel(event) {\r\n\t\t\tif (event.deltaY < 0) {\r\n\t\t\t\tdollyOut(getZoomScale());\r\n\t\t\t}\r\n\t\t\telse if (event.deltaY > 0) {\r\n\t\t\t\tdollyIn(getZoomScale());\r\n\t\t\t}\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleKeyDown(event) {\r\n\t\t\tswitch (event.keyCode) {\r\n\t\t\t\tcase scope.keys.UP:\r\n\t\t\t\t\tpan(0, scope.keyPanSpeed);\r\n\t\t\t\t\tscope.update();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\t\tpan(0, -scope.keyPanSpeed);\r\n\t\t\t\t\tscope.update();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\t\tpan(scope.keyPanSpeed, 0);\r\n\t\t\t\t\tscope.update();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\t\tpan(-scope.keyPanSpeed, 0);\r\n\t\t\t\t\tscope.update();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction handleTouchStartRotate(event) {\r\n\t\t\trotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t}\r\n\t\tfunction handleTouchStartDolly(event) {\r\n\t\t\tlet dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\tlet dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\t\t\tlet distance = Math.sqrt(dx * dx + dy * dy);\r\n\t\t\tdollyStart.set(0, distance);\r\n\t\t}\r\n\t\tfunction handleTouchStartPan(event) {\r\n\t\t\tpanStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t}\r\n\t\tfunction handleTouchMoveRotate(event) {\r\n\t\t\trotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t\trotateDelta.subVectors(rotateEnd, rotateStart);\r\n\t\t\tlet element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\t\t\trotateLeft(2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed);\r\n\t\t\trotateUp(2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed);\r\n\t\t\trotateStart.copy(rotateEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleTouchMoveDolly(event) {\r\n\t\t\tlet dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\t\tlet dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\t\t\tlet distance = Math.sqrt(dx * dx + dy * dy);\r\n\t\t\tdollyEnd.set(0, distance);\r\n\t\t\tdollyDelta.subVectors(dollyEnd, dollyStart);\r\n\t\t\tif (dollyDelta.y > 0) {\r\n\t\t\t\tdollyOut(getZoomScale());\r\n\t\t\t}\r\n\t\t\telse if (dollyDelta.y < 0) {\r\n\t\t\t\tdollyIn(getZoomScale());\r\n\t\t\t}\r\n\t\t\tdollyStart.copy(dollyEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleTouchMovePan(event) {\r\n\t\t\tpanEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t\tpanDelta.subVectors(panEnd, panStart);\r\n\t\t\tpan(panDelta.x, panDelta.y);\r\n\t\t\tpanStart.copy(panEnd);\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t\tfunction handleTouchEnd(event) {\r\n\t\t}\r\n\t\t//\r\n\t\t// event handlers - FSM: listen for events and reset state\r\n\t\t//\r\n\t\tfunction onMouseDown(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\tswitch (event.button) {\r\n\t\t\t\tcase scope.mouseButtons.ORBIT:\r\n\t\t\t\t\tif (scope.enableRotate === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseDownRotate(event);\r\n\t\t\t\t\tstate = STATE.ROTATE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase scope.mouseButtons.ZOOM:\r\n\t\t\t\t\tif (scope.enableZoom === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseDownDolly(event);\r\n\t\t\t\t\tstate = STATE.DOLLY;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase scope.mouseButtons.PAN:\r\n\t\t\t\t\tif (scope.enablePan === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseDownPan(event);\r\n\t\t\t\t\tstate = STATE.PAN;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n\t\t\tif (state !== STATE.NONE) {\r\n\t\t\t\tdocument.addEventListener(\"mousemove\", onMouseMove, false);\r\n\t\t\t\tdocument.addEventListener(\"mouseup\", onMouseUp, false);\r\n\t\t\t\tscope.dispatchEvent(startEvent);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction onMouseMove(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\tswitch (state) {\r\n\t\t\t\tcase STATE.ROTATE:\r\n\t\t\t\t\tif (scope.enableRotate === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseMoveRotate(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase STATE.DOLLY:\r\n\t\t\t\t\tif (scope.enableZoom === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseMoveDolly(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase STATE.PAN:\r\n\t\t\t\t\tif (scope.enablePan === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleMouseMovePan(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\tfunction onMouseUp(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\thandleMouseUp(event);\r\n\t\t\tdocument.removeEventListener(\"mousemove\", onMouseMove, false);\r\n\t\t\tdocument.removeEventListener(\"mouseup\", onMouseUp, false);\r\n\t\t\tscope.dispatchEvent(endEvent);\r\n\t\t\tstate = STATE.NONE;\r\n\t\t}\r\n\t\tfunction onMouseWheel(event) {\r\n\t\t\tif (scope.enabled === false || scope.enableZoom === false || (state !== STATE.NONE && state !== STATE.ROTATE))\r\n\t\t\t\treturn;\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\t\t\thandleMouseWheel(event);\r\n\t\t\tscope.dispatchEvent(startEvent); // not sure why these are here...\r\n\t\t\tscope.dispatchEvent(endEvent);\r\n\t\t}\r\n\t\tfunction onKeyDown(event) {\r\n\t\t\tif (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false)\r\n\t\t\t\treturn;\r\n\t\t\thandleKeyDown(event);\r\n\t\t}\r\n\t\tfunction onTouchStart(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\tswitch (event.touches.length) {\r\n\t\t\t\tcase 1:// one-fingered touch: rotate\r\n\t\t\t\t\tif (scope.enableRotate === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleTouchStartRotate(event);\r\n\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:// two-fingered touch: dolly\r\n\t\t\t\t\tif (scope.enableZoom === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleTouchStartDolly(event);\r\n\t\t\t\t\tstate = STATE.TOUCH_DOLLY;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:// three-fingered touch: pan\r\n\t\t\t\t\tif (scope.enablePan === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\thandleTouchStartPan(event);\r\n\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t}\r\n\t\t\tif (state !== STATE.NONE) {\r\n\t\t\t\tscope.dispatchEvent(startEvent);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction onTouchMove(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\tswitch (event.touches.length) {\r\n\t\t\t\tcase 1:// one-fingered touch: rotate\r\n\t\t\t\t\tif (scope.enableRotate === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tif (state !== STATE.TOUCH_ROTATE)\r\n\t\t\t\t\t\treturn; // is this needed?...\r\n\t\t\t\t\thandleTouchMoveRotate(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:// two-fingered touch: dolly\r\n\t\t\t\t\tif (scope.enableZoom === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tif (state !== STATE.TOUCH_DOLLY)\r\n\t\t\t\t\t\treturn; // is this needed?...\r\n\t\t\t\t\thandleTouchMoveDolly(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 3:// three-fingered touch: pan\r\n\t\t\t\t\tif (scope.enablePan === false)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\tif (state !== STATE.TOUCH_PAN)\r\n\t\t\t\t\t\treturn; // is this needed?...\r\n\t\t\t\t\thandleTouchMovePan(event);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t}\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopPropagation();\r\n\t\t}\r\n\t\tfunction onTouchEnd(event) {\r\n\t\t\tif (scope.enabled === false)\r\n\t\t\t\treturn;\r\n\t\t\thandleTouchEnd(event);\r\n\t\t\tscope.dispatchEvent(endEvent);\r\n\t\t\tstate = STATE.NONE;\r\n\t\t}\r\n\t\tfunction onContextMenu(event) {\r\n\t\t\tif (scope.enabled === false || scope.enablePan === false)\r\n\t\t\t\treturn;\r\n\t\t\tevent.preventDefault();\r\n\t\t}\r\n\t\t//\r\n\t\tscope.domElement.addEventListener(\"contextmenu\", onContextMenu, false);\r\n\t\tscope.domElement.addEventListener(\"mousedown\", onMouseDown, false);\r\n\t\tscope.domElement.addEventListener(\"wheel\", onMouseWheel, false);\r\n\t\tscope.domElement.addEventListener(\"touchstart\", onTouchStart, false);\r\n\t\tscope.domElement.addEventListener(\"touchend\", onTouchEnd, false);\r\n\t\tscope.domElement.addEventListener(\"touchmove\", onTouchMove, false);\r\n\t\twindow.addEventListener(\"keydown\", onKeyDown, false);\r\n\t\t// force an update at start\r\n\t\tthis.update();\r\n\t}\r\n}\r\n\r\nexport { OrbitControls };\r\n","function invokeAnimation(animation, player, time) {\r\n\tif (animation instanceof CompositeAnimation) {\r\n\t\tanimation.play(player, time);\r\n\t} else if (animation instanceof Function) {\r\n\t\tanimation(player, time);\r\n\t} else {\r\n\t\tthrow `Not an animation: ${animation}`;\r\n\t}\r\n}\r\n\r\nclass AnimationHandle {\r\n\tconstructor(animation) {\r\n\t\tthis.animation = animation;\r\n\t\tthis.paused = this._paused = false;\r\n\t\tthis.speed = this._speed = 1.0;\r\n\t\tthis._lastChange = null;\r\n\t\tthis._lastChangeX = null;\r\n\t}\r\n\tplay(player, time) {\r\n\t\tif (this._lastChange === null) {\r\n\t\t\tthis._lastChange = time;\r\n\t\t\tthis._lastChangeX = 0;\r\n\t\t} else if (this.paused !== this._paused || this.speed !== this._speed) {\r\n\t\t\tlet dt = time - this._lastChange;\r\n\t\t\tif (this._paused === false) {\r\n\t\t\t\tthis._lastChangeX += dt * this._speed;\r\n\t\t\t}\r\n\t\t\tthis._paused = this.paused;\r\n\t\t\tthis._speed = this.speed;\r\n\t\t\tthis._lastChange = time;\r\n\t\t}\r\n\t\tif (this.paused === false) {\r\n\t\t\tlet dt = time - this._lastChange;\r\n\t\t\tlet x = this._lastChangeX + this.speed * dt;\r\n\t\t\tinvokeAnimation(this.animation, player, x);\r\n\t\t}\r\n\t}\r\n\treset(){\r\n\t\tthis._lastChange = null;\r\n\t}\r\n}\r\n\r\nclass CompositeAnimation {\r\n\tconstructor() {\r\n\t\tthis.handles = new Set();\r\n\t}\r\n\tadd(animation) {\r\n\t\tlet handle = new AnimationHandle(animation);\r\n\t\thandle.remove = () => this.handles.delete(handle);\r\n\t\tthis.handles.add(handle);\r\n\t\treturn handle;\r\n\t}\r\n\tplay(player, time) {\r\n\t\tthis.handles.forEach(handle => handle.play(player, time));\r\n\t}\r\n}\r\n\r\nlet WalkAnimation = (player, time) => {\r\n\tlet skin = player.skin;\r\n\tlet angleRot = time + Math.PI / 2;\r\n\r\n\t// Leg Swing\r\n\tskin.leftLeg.rotation.x = Math.cos(angleRot);\r\n\tskin.rightLeg.rotation.x = Math.cos(angleRot + (Math.PI));\r\n\r\n\t// Arm Swing\r\n\tskin.leftArm.rotation.x = Math.cos(angleRot + (Math.PI));\r\n\tskin.rightArm.rotation.x = Math.cos(angleRot);\r\n};\r\n\r\nexport { CompositeAnimation, WalkAnimation, invokeAnimation };\r\n","import * as THREE from \"three\";\r\nimport { PlayerObject } from \"./model\";\r\nimport { OrbitControls } from \"./orbit_controls\";\r\nimport { invokeAnimation } from \"./animation\";\r\n\r\nfunction copyImage(context, sX, sY, w, h, dX, dY, flipHorizontal) {\r\n\tlet imgData = context.getImageData(sX, sY, w, h);\r\n\tif (flipHorizontal) {\r\n\t\tfor (let y = 0; y < h; y++) {\r\n\t\t\tfor (let x = 0; x < (w / 2); x++) {\r\n\t\t\t\tlet index = (x + y * w) * 4;\r\n\t\t\t\tlet index2 = ((w - x - 1) + y * w) * 4;\r\n\t\t\t\tlet pA1 = imgData.data[index];\r\n\t\t\t\tlet pA2 = imgData.data[index + 1];\r\n\t\t\t\tlet pA3 = imgData.data[index + 2];\r\n\t\t\t\tlet pA4 = imgData.data[index + 3];\r\n\r\n\t\t\t\tlet pB1 = imgData.data[index2];\r\n\t\t\t\tlet pB2 = imgData.data[index2 + 1];\r\n\t\t\t\tlet pB3 = imgData.data[index2 + 2];\r\n\t\t\t\tlet pB4 = imgData.data[index2 + 3];\r\n\r\n\t\t\t\timgData.data[index] = pB1;\r\n\t\t\t\timgData.data[index + 1] = pB2;\r\n\t\t\t\timgData.data[index + 2] = pB3;\r\n\t\t\t\timgData.data[index + 3] = pB4;\r\n\r\n\t\t\t\timgData.data[index2] = pA1;\r\n\t\t\t\timgData.data[index2 + 1] = pA2;\r\n\t\t\t\timgData.data[index2 + 2] = pA3;\r\n\t\t\t\timgData.data[index2 + 3] = pA4;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tcontext.putImageData(imgData, dX, dY);\r\n}\r\n\r\nfunction convertSkinTo1_8(context, width) {\r\n\tlet scale = width / 64.0;\r\n\tlet copySkin = (context, sX, sY, w, h, dX, dY, flipHorizontal) => copyImage(context, sX * scale, sY * scale, w * scale, h * scale, dX * scale, dY * scale, flipHorizontal);\r\n\r\n\tcopySkin(context, 4, 16, 4, 4, 20, 48, true); // Top Leg\r\n\tcopySkin(context, 8, 16, 4, 4, 24, 48, true); // Bottom Leg\r\n\tcopySkin(context, 0, 20, 4, 12, 24, 52, true); // Outer Leg\r\n\tcopySkin(context, 4, 20, 4, 12, 20, 52, true); // Front Leg\r\n\tcopySkin(context, 8, 20, 4, 12, 16, 52, true); // Inner Leg\r\n\tcopySkin(context, 12, 20, 4, 12, 28, 52, true); // Back Leg\r\n\tcopySkin(context, 44, 16, 4, 4, 36, 48, true); // Top Arm\r\n\tcopySkin(context, 48, 16, 4, 4, 40, 48, true); // Bottom Arm\r\n\tcopySkin(context, 40, 20, 4, 12, 40, 52, true); // Outer Arm\r\n\tcopySkin(context, 44, 20, 4, 12, 36, 52, true); // Front Arm\r\n\tcopySkin(context, 48, 20, 4, 12, 32, 52, true); // Inner Arm\r\n\tcopySkin(context, 52, 20, 4, 12, 44, 52, true); // Back Arm\r\n}\r\n\r\nclass SkinViewer {\r\n\tconstructor(options) {\r\n\t\tthis.domElement = options.domElement;\r\n\t\tthis.animation = options.animation || null;\r\n\t\tthis.animationPaused = false;\r\n\t\tthis.animationTime = 0;\r\n\t\tthis.disposed = false;\r\n\r\n\t\t// texture\r\n\t\tthis.skinImg = new Image();\r\n\t\tthis.skinCanvas = document.createElement(\"canvas\");\r\n\t\tthis.skinTexture = new THREE.Texture(this.skinCanvas);\r\n\t\tthis.skinTexture.magFilter = THREE.NearestFilter;\r\n\t\tthis.skinTexture.minFilter = THREE.NearestMipMapNearestFilter;\r\n\r\n\t\tthis.capeImg = new Image();\r\n\t\tthis.capeCanvas = document.createElement(\"canvas\");\r\n\t\tthis.capeTexture = new THREE.Texture(this.capeCanvas);\r\n\t\tthis.capeTexture.magFilter = THREE.NearestFilter;\r\n\t\tthis.capeTexture.minFilter = THREE.NearestMipMapNearestFilter;\r\n\r\n\t\tthis.layer1Material = new THREE.MeshBasicMaterial({ map: this.skinTexture, side: THREE.FrontSide });\r\n\t\tthis.layer2Material = new THREE.MeshBasicMaterial({ map: this.skinTexture, transparent: true, opacity: 1, side: THREE.DoubleSide });\r\n\t\tthis.capeMaterial = new THREE.MeshBasicMaterial({ map: this.capeTexture });\r\n\r\n\t\t// scene\r\n\t\tthis.scene = new THREE.Scene();\r\n\r\n\t\tthis.camera = new THREE.PerspectiveCamera(75);\r\n\t\tthis.camera.position.y = -12;\r\n\t\tthis.camera.position.z = 30;\r\n\r\n\t\tthis.renderer = new THREE.WebGLRenderer({ angleRot: true, alpha: true, antialias: false });\r\n\t\tthis.renderer.setSize(300, 300); // default size\r\n\t\tthis.renderer.context.getShaderInfoLog = () => \"\"; // shut firefox up\r\n\t\tthis.domElement.appendChild(this.renderer.domElement);\r\n\r\n\t\tthis.playerObject = new PlayerObject(options.slim === true, this.layer1Material, this.layer2Material, this.capeMaterial);\r\n\t\tthis.scene.add(this.playerObject);\r\n\r\n\t\t// texture loading\r\n\t\tthis.skinImg.crossOrigin = \"\";\r\n\t\tthis.skinImg.onerror = () => console.error(\"Failed loading \" + this.skinImg.src);\r\n\t\tthis.skinImg.onload = () => {\r\n\t\t\tlet isOldFormat = false;\r\n\t\t\tif (this.skinImg.width !== this.skinImg.height) {\r\n\t\t\t\tif (this.skinImg.width === 2 * this.skinImg.height) {\r\n\t\t\t\t\tisOldFormat = true;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(\"Bad skin size\");\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tlet skinContext = this.skinCanvas.getContext(\"2d\");\r\n\t\t\tif (isOldFormat) {\r\n\t\t\t\tlet width = this.skinImg.width;\r\n\t\t\t\tthis.skinCanvas.width = width;\r\n\t\t\t\tthis.skinCanvas.height = width;\r\n\t\t\t\tskinContext.clearRect(0, 0, width, width);\r\n\t\t\t\tskinContext.drawImage(this.skinImg, 0, 0, width, width / 2.0);\r\n\t\t\t\tconvertSkinTo1_8(skinContext, width);\r\n\t\t\t} else {\r\n\t\t\t\tthis.skinCanvas.width = this.skinImg.width;\r\n\t\t\t\tthis.skinCanvas.height = this.skinImg.height;\r\n\t\t\t\tskinContext.clearRect(0, 0, this.skinCanvas.width, this.skinCanvas.height);\r\n\t\t\t\tskinContext.drawImage(this.skinImg, 0, 0, this.skinCanvas.width, this.skinCanvas.height);\r\n\t\t\t}\r\n\r\n\t\t\tthis.skinTexture.needsUpdate = true;\r\n\t\t\tthis.layer1Material.needsUpdate = true;\r\n\t\t\tthis.layer2Material.needsUpdate = true;\r\n\r\n\t\t\tthis.playerObject.skin.visible = true;\r\n\t\t};\r\n\r\n\t\tthis.capeImg.crossOrigin = \"\";\r\n\t\tthis.capeImg.onerror = () => console.error(\"Failed loading \" + this.capeImg.src);\r\n\t\tthis.capeImg.onload = () => {\r\n\t\t\tif (this.capeImg.width !== 2 * this.capeImg.height) {\r\n\t\t\t\tconsole.error(\"Bad cape size\");\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.capeCanvas.width = this.capeImg.width;\r\n\t\t\tthis.capeCanvas.height = this.capeImg.height;\r\n\t\t\tlet capeContext = this.capeCanvas.getContext(\"2d\");\r\n\t\t\tcapeContext.clearRect(0, 0, this.capeCanvas.width, this.capeCanvas.height);\r\n\t\t\tcapeContext.drawImage(this.capeImg, 0, 0, this.capeCanvas.width, this.capeCanvas.height);\r\n\r\n\t\t\tthis.capeTexture.needsUpdate = true;\r\n\t\t\tthis.capeMaterial.needsUpdate = true;\r\n\r\n\t\t\tthis.playerObject.cape.visible = true;\r\n\t\t};\r\n\r\n\t\tif (options.skinUrl) this.skinUrl = options.skinUrl;\r\n\t\tif (options.capeUrl) this.capeUrl = options.capeUrl;\r\n\t\tif (options.width) this.width = options.width;\r\n\t\tif (options.height) this.height = options.height;\r\n\r\n\t\tlet draw = () => {\r\n\t\t\tif (this.disposed) return;\r\n\t\t\twindow.requestAnimationFrame(draw);\r\n\t\t\tif (!this.animationPaused) {\r\n\t\t\t\tthis.animationTime++;\r\n\t\t\t\tif (this.animation) {\r\n\t\t\t\t\tinvokeAnimation(this.animation, this.playerObject, this.animationTime / 100.0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.renderer.render(this.scene, this.camera);\r\n\t\t};\r\n\t\tdraw();\r\n\t}\r\n\r\n\tsetSize(width, height) {\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.renderer.setSize(width, height);\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tthis.disposed = true;\r\n\t\tthis.domElement.removeChild(this.renderer.domElement);\r\n\t\tthis.renderer.dispose();\r\n\t\tthis.skinTexture.dispose();\r\n\t\tthis.capeTexture.dispose();\r\n\t}\r\n\r\n\tget skinUrl() {\r\n\t\treturn this.skinImg.src;\r\n\t}\r\n\r\n\tset skinUrl(url) {\r\n\t\tthis.skinImg.src = url;\r\n\t}\r\n\r\n\tget capeUrl() {\r\n\t\treturn this.capeImg.src;\r\n\t}\r\n\r\n\tset capeUrl(url) {\r\n\t\tthis.capeImg.src = url;\r\n\t}\r\n\r\n\tget width() {\r\n\t\treturn this.renderer.getSize().width;\r\n\t}\r\n\r\n\tset width(newWidth) {\r\n\t\tthis.setSize(newWidth, this.height);\r\n\t}\r\n\r\n\tget height() {\r\n\t\treturn this.renderer.getSize().height;\r\n\t}\r\n\r\n\tset height(newHeight) {\r\n\t\tthis.setSize(this.width, newHeight);\r\n\t}\r\n}\r\n\r\nclass SkinControl {\r\n\tconstructor(skinViewer) {\r\n\t\tthis.enableAnimationControl = true;\r\n\t\tthis.skinViewer = skinViewer;\r\n\r\n\t\tthis.orbitControls = new OrbitControls(skinViewer.camera, skinViewer.renderer.domElement);\r\n\t\tthis.orbitControls.enablePan = false;\r\n\t\tthis.orbitControls.target = new THREE.Vector3(0, -12, 0);\r\n\t\tthis.orbitControls.minDistance = 10;\r\n\t\tthis.orbitControls.maxDistance = 256;\r\n\t\tthis.orbitControls.update();\r\n\r\n\t\tthis.animationPauseListener = e => {\r\n\t\t\tif (this.enableAnimationControl) {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.skinViewer.animationPaused = !this.skinViewer.animationPaused;\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.skinViewer.domElement.addEventListener(\"contextmenu\", this.animationPauseListener, false);\r\n\t}\r\n\r\n\tdispose() {\r\n\t\tthis.skinViewer.domElement.removeEventListener(\"contextmenu\", this.animationPauseListener, false);\r\n\t\tthis.orbitControls.dispose();\r\n\t}\r\n}\r\n\r\nexport { SkinViewer, SkinControl };\r\n"],"names":["toFaceVertices","x1","y1","x2","y2","w","h","THREE","toSkinVertices","toCapeVertices","addVertices","box","top","bottom","left","front","right","back","faceVertexUvs","esp","SkinObject","isSlim","layer1Material","layer2Material","head","headBox","headMesh","add","head2Box","head2Mesh","renderOrder","_this","body","bodyBox","bodyMesh","body2Box","body2Mesh","position","y","rightArm","rightArmPivot","rightArmBox","rightArmMesh","rightArm2Box","rightArm2Mesh","x","leftArm","leftArmPivot","leftArmBox","leftArmMesh","leftArm2Box","leftArm2Mesh","rightLeg","rightLegPivot","rightLegBox","rightLegMesh","rightLeg2Box","rightLeg2Mesh","leftLeg","leftLegPivot","leftLegBox","leftLegMesh","leftLeg2Box","leftLeg2Mesh","CapeObject","capeMaterial","capeBox","cape","z","_this2","PlayerObject","slim","skin","visible","_this3","rotation","Math","PI","OrbitControls","object","domElement","offset","quat","quatInverse","lastPosition","lastQuaternion","undefined","document","enabled","target","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","keys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","ORBIT","ZOOM","MIDDLE","PAN","target0","clone","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","copy","scope","reset","updateProjectionMatrix","dispatchEvent","changeEvent","update","STATE","NONE","setFromUnitVectors","up","inverse","sub","applyQuaternion","setFromVector3","state","sphericalDelta","max","min","makeSafe","radius","scale","panOffset","setFromSpherical","lookAt","set","zoomChanged","distanceToSquared","EPS","dot","quaternion","dispose","removeEventListener","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseMove","onMouseUp","onKeyDown","type","startEvent","endEvent","ROTATE","DOLLY","TOUCH_ROTATE","TOUCH_DOLLY","TOUCH_PAN","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","rotateLeft","angle","rotateUp","v","panLeft","distance","objectMatrix","setFromMatrixColumn","multiplyScalar","panUp","pan","deltaX","deltaY","element","targetDistance","length","tan","fov","clientHeight","matrix","clientWidth","warn","dollyIn","dollyScale","dollyOut","event","button","clientX","clientY","preventDefault","addEventListener","subVectors","stopPropagation","keyCode","touches","pageX","pageY","dx","dy","sqrt","invokeAnimation","animation","player","time","CompositeAnimation","play","Function","AnimationHandle","paused","this","_paused","speed","_speed","_lastChange","_lastChangeX","dt","handles","Set","handle","remove","delete","forEach","SkinViewer","options","animationPaused","animationTime","disposed","skinImg","Image","skinCanvas","createElement","skinTexture","magFilter","minFilter","capeImg","capeCanvas","capeTexture","map","side","transparent","opacity","scene","camera","renderer","angleRot","alpha","antialias","setSize","context","getShaderInfoLog","appendChild","playerObject","crossOrigin","onerror","console","error","src","onload","isOldFormat","width","height","skinContext","getContext","clearRect","drawImage","copySkin","sX","sY","dX","dY","flipHorizontal","imgData","getImageData","index","index2","pA1","data","pA2","pA3","pA4","pB1","pB2","pB3","pB4","putImageData","copyImage","needsUpdate","capeContext","skinUrl","capeUrl","draw","requestAnimationFrame","render","aspect","removeChild","url","getSize","newWidth","newHeight","SkinControl","skinViewer","enableAnimationControl","orbitControls","animationPauseListener","cos"],"mappings":"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"}